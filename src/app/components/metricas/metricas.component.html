<ion-card>
  <ion-card-header>
    <ion-card-title>3) Métricas</ion-card-title>
  </ion-card-header>
  <ion-card-content>
    <!-- Control de visibilidad -->
    <ion-card>
      <ion-card-content>
        <ion-item lines="none">
          <ion-checkbox
            slot="start"
            [(ngModel)]="ocultarUbicacionCharts"
            (ionChange)="onToggleUbicacionCharts()"
          ></ion-checkbox>
          <ion-label>Ocultar gráficos por ubicación</ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- KPIs -->
    <div class="kpis">
      <ion-card class="kpi">
        <ion-card-content>
          <div class="kpi-title">Reportes filtrados</div>
          <div class="kpi-value">{{ filtered.length || 0 }}</div>
        </ion-card-content>
      </ion-card>
      <ion-card class="kpi">
        <ion-card-content>
          <div class="kpi-title">Cámaras totales (suma filas)</div>
          <div class="kpi-value">{{ metrics.totalCamaras }}</div>
        </ion-card-content>
      </ion-card>
      <ion-card class="kpi">
        <ion-card-content>
          <div class="kpi-title">Cámaras operativas</div>
          <div class="kpi-value">{{ metrics.operativasInterpretadas }}</div>
        </ion-card-content>
      </ion-card>
      <ion-card class="kpi">
        <ion-card-content>
          <div class="kpi-title">Cámaras con fallas</div>
          <div class="kpi-value">{{ metrics.camarasConFalla }}</div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- GRÁFICOS -->
    <div class="charts">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Operativas vs Totales</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <canvas #chartOperativas></canvas>
          <p class="chart-desc">
            Muestra la proporción de cámaras que se estiman operativas frente al total registrado.
          </p>
        </ion-card-content>
      </ion-card>

      <ion-card>
        <ion-card-header>
          <ion-card-title>Distribución por Momento</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <canvas #chartMomento></canvas>
          <p class="chart-desc">
            Permite ver en qué momento del día (mañana, tarde, noche) ocurren más incidentes reportados.
          </p>
        </ion-card-content>
      </ion-card>

      <!-- Reportes por Ubicación (ocultable) -->
      <ion-card *ngIf="!ocultarUbicacionCharts">
        <ion-card-header>
          <ion-card-title>Reportes por Ubicación</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <canvas #chartReportesUbicacion></canvas>
          <p class="chart-desc">
            Indica cuáles ubicaciones concentran la mayor cantidad de reportes realizados.
          </p>
        </ion-card-content>
      </ion-card>

      <!-- Cámaras con Falla por Ubicación (ocultable) -->
      <ion-card *ngIf="!ocultarUbicacionCharts">
        <ion-card-header>
          <ion-card-title>Cámaras con Falla por Ubicación</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <canvas #chartFallaUbicacion></canvas>
          <p class="chart-desc">
            Muestra dónde se encuentran la mayor cantidad de cámaras con fallas registradas.
          </p>
        </ion-card-content>
      </ion-card>
    </div>
  </ion-card-content>
</ion-card>
